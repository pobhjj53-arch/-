<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚¸é‡‘èŠ±èƒœç‡è®¡ç®—å™¨ ğŸ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: bold;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .section h2 {
            color: #666;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .mode-selector {
            margin-bottom: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
        }

        .mode-selector label {
            margin-right: 20px;
            font-size: 16px;
            color: #1976d2;
            font-weight: 500;
        }

        .mode-selector input[type="radio"] {
            margin-right: 5px;
            transform: scale(1.2);
        }

        .card-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .card-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
            font-weight: 500;
        }

        .card-group select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            width: 120px;
            background: white;
            transition: all 0.3s ease;
        }

        .card-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
            font-weight: 500;
        }

        .input-group input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            width: 100%;
            background: white;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group .hint {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        #result {
            margin-top: 30px;
            padding: 20px;
            background: #e8f5e8;
            border-radius: 10px;
            border-left: 5px solid #4caf50;
            display: none;
        }

        #result h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            font-size: 18px;
        }

        #result .result-item {
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
        }

        #result .result-value {
            font-weight: bold;
            color: #4caf50;
        }

        #result .mode-info {
            margin-bottom: 15px;
            padding: 10px;
            background: #c8e6c9;
            border-radius: 5px;
            color: #2e7d32;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            .card-group {
                flex-direction: column;
            }

            .card-group select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç‚¸é‡‘èŠ±èƒœç‡è®¡ç®—å™¨ ğŸ²</h1>

        <div class="section">
            <h2>æ¸¸æˆæ¨¡å¼é€‰æ‹©</h2>
            <div class="mode-selector">
                <label>
                    <input type="radio" name="game-mode" value="classic" checked>
                    ç»å…¸æ¨¡å¼ (æ¯äºº3å¼ ç‰Œ)
                </label>
                <label>
                    <input type="radio" name="game-mode" value="advanced">
                    è¿›é˜¶æ¨¡å¼ (æ¯äºº4å¼ ç‰Œï¼Œè‡ªåŠ¨é€‰æœ€ä¼˜3å¼ )
                </label>
            </div>
        </div>

        <div class="section">
            <h2>è¾“å…¥ä½ çš„æ‰‹ç‰Œ</h2>
            <div class="card-group">
                <div>
                    <label>ç¬¬1å¼ ç‰Œ - ç‚¹æ•°</label>
                    <select id="card1-value">
                        <option value="1">A</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">J</option>
                        <option value="12">Q</option>
                        <option value="13">K</option>
                    </select>
                </div>
                <div>
                    <label>ç¬¬1å¼ ç‰Œ - èŠ±è‰²</label>
                    <select id="card1-suit">
                        <option value="0">çº¢æ¡ƒ</option>
                        <option value="1">æ–¹ç‰‡</option>
                        <option value="2">æ¢…èŠ±</option>
                        <option value="3">é»‘æ¡ƒ</option>
                    </select>
                </div>
            </div>

            <div class="card-group">
                <div>
                    <label>ç¬¬2å¼ ç‰Œ - ç‚¹æ•°</label>
                    <select id="card2-value">
                        <option value="1">A</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">J</option>
                        <option value="12">Q</option>
                        <option value="13">K</option>
                    </select>
                </div>
                <div>
                    <label>ç¬¬2å¼ ç‰Œ - èŠ±è‰²</label>
                    <select id="card2-suit">
                        <option value="0">çº¢æ¡ƒ</option>
                        <option value="1">æ–¹ç‰‡</option>
                        <option value="2">æ¢…èŠ±</option>
                        <option value="3">é»‘æ¡ƒ</option>
                    </select>
                </div>
            </div>

            <div class="card-group">
                <div>
                    <label>ç¬¬3å¼ ç‰Œ - ç‚¹æ•°</label>
                    <select id="card3-value">
                        <option value="1">A</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">J</option>
                        <option value="12">Q</option>
                        <option value="13">K</option>
                    </select>
                </div>
                <div>
                    <label>ç¬¬3å¼ ç‰Œ - èŠ±è‰²</label>
                    <select id="card3-suit">
                        <option value="0">çº¢æ¡ƒ</option>
                        <option value="1">æ–¹ç‰‡</option>
                        <option value="2">æ¢…èŠ±</option>
                        <option value="3">é»‘æ¡ƒ</option>
                    </select>
                </div>
            </div>

            <div class="card-group" id="card4-group" style="display: none;">
                <div>
                    <label>ç¬¬4å¼ ç‰Œ - ç‚¹æ•°</label>
                    <select id="card4-value">
                        <option value="1">A</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">J</option>
                        <option value="12">Q</option>
                        <option value="13">K</option>
                    </select>
                </div>
                <div>
                    <label>ç¬¬4å¼ ç‰Œ - èŠ±è‰²</label>
                    <select id="card4-suit">
                        <option value="0">çº¢æ¡ƒ</option>
                        <option value="1">æ–¹ç‰‡</option>
                        <option value="2">æ¢…èŠ±</option>
                        <option value="3">é»‘æ¡ƒ</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>æ¸¸æˆè®¾ç½®</h2>
            <div class="input-group">
                <label>æ€»ç©å®¶äººæ•°</label>
                <input type="number" id="player-count" value="6" min="3" max="10">
                <div class="hint">å¯é€‰èŒƒå›´ï¼š3-10</div>
            </div>
            <div class="input-group">
                <label>æ¨¡æ‹Ÿå±€æ•°</label>
                <input type="number" id="simulation-count" value="10000" min="1000">
                <div class="hint">å»ºè®®è®¾ç½®10000+</div>
            </div>
        </div>

        <button onclick="calculate()">è®¡ç®—èƒœç‡</button>

        <div id="result">
            <h3>è®¡ç®—ç»“æœ</h3>
            <div class="mode-info" id="mode-info"></div>
            <div class="result-item">èƒœç‡ï¼š<span id="win-rate" class="result-value"></span></div>
            <!-- æ–°å¢ï¼šå¼ƒç‰Œå»ºè®®è¡Œï¼Œæ ·å¼ä¸åŸæœ‰ç»“æœé¡¹ä¸€è‡´ -->
            <div class="result-item">å»ºè®®ï¼š<span id="advice-text" class="result-value"></span></div>
        </div>
    </div>

    <script>
        // æ¨¡å¼åˆ‡æ¢äº‹ä»¶
        document.querySelectorAll('input[name="game-mode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const card4Group = document.getElementById('card4-group');
                if (this.value === 'advanced') {
                    card4Group.style.display = 'flex';
                } else {
                    card4Group.style.display = 'none';
                }
            });
        });

        // --- åŸºç¡€å®šä¹‰ ---
        const SUIT_NAMES = ["çº¢æ¡ƒ", "æ–¹ç‰‡", "æ¢…èŠ±", "é»‘æ¡ƒ"];
        const HAND_TYPE_NAMES = ["è±¹å­", "é¡ºé‡‘", "é‡‘èŠ±", "é¡ºå­", "å¯¹å­", "å•å¼ "];

        class Card {
            constructor(value, suit) {
                this.value = value;   // 1-13, A=1
                this.suit = suit;      // 0-3
            }

            toString() {
                let valStr;
                switch (this.value) {
                    case 1: valStr = "A"; break;
                    case 11: valStr = "J"; break;
                    case 12: valStr = "Q"; break;
                    case 13: valStr = "K"; break;
                    default: valStr = this.value.toString(); break;
                }
                return valStr + SUIT_NAMES[this.suit];
            }
        }

        class Hand {
            constructor(cards) {
                this.cards = cards;
                // æŒ‰é™åºæ’åºï¼ŒAè§†ä¸º14
                this.cards.sort((a, b) => {
                    const va = (a.value === 1) ? 14 : a.value;
                    const vb = (b.value === 1) ? 14 : b.value;
                    return vb - va;
                });
            }

            getHandType() {
                const isFlush = (this.cards[0].suit === this.cards[1].suit && this.cards[1].suit === this.cards[2].suit);
                let isStraight = false;
                let straightVals = []; // ç”¨äºé¡ºå­å’Œé¡ºé‡‘çš„é™åºå€¼

                const v0 = this.cards[0].value; // åŸå§‹å€¼ï¼ŒA=1
                const v1 = this.cards[1].value;
                const v2 = this.cards[2].value;

                const hasPair = (v0 === v1 || v1 === v2 || v0 === v2);
                const hasThree = (v0 === v1 && v1 === v2);

                // é¡ºå­åˆ¤å®šï¼šä½¿ç”¨åŸå§‹å€¼æ’åºååˆ¤æ–­
                let sortedVals = [v0, v1, v2];
                sortedVals.sort((a, b) => a - b); // å‡åºï¼Œ1æœ€å°

                if (sortedVals[0] === 1 && sortedVals[1] === 2 && sortedVals[2] === 3) {
                    // A23 é¡ºå­ï¼ˆæœ€å°ï¼‰
                    isStraight = true;
                    straightVals = [3, 2, 1]; // é™åºï¼ŒAä»ä¸º1ï¼ˆæœ€å°ï¼‰
                } else if (sortedVals[0] === 1 && sortedVals[1] === 12 && sortedVals[2] === 13) {
                    // QKA é¡ºå­ï¼ˆæœ€å¤§ï¼‰
                    isStraight = true;
                    straightVals = [14, 13, 12]; // é™åºï¼ŒAè§†ä¸º14
                } else if (sortedVals[1] === sortedVals[0] + 1 && sortedVals[2] === sortedVals[1] + 1) {
                    // æ™®é€šé¡ºå­
                    isStraight = true;
                    straightVals = [sortedVals[2], sortedVals[1], sortedVals[0]]; // é™åº
                }

                if (hasThree) return { type: 0, values: [v0] }; // è±¹å­ï¼Œå€¼éšååœ¨å¼ºåº¦ä¸­è½¬æ¢
                if (isFlush && isStraight) return { type: 1, values: straightVals }; // é¡ºé‡‘
                if (isFlush) return { type: 2, values: [v0, v1, v2] }; // é‡‘èŠ±ï¼Œå·²é™åº
                if (isStraight) return { type: 3, values: straightVals }; // é¡ºå­
                if (hasPair) {
                    let pairValue, singleValue;
                    if (v0 === v1) {
                        pairValue = v0;
                        singleValue = v2;
                    } else if (v1 === v2) {
                        pairValue = v1;
                        singleValue = v0;
                    } else { // v0 === v2
                        pairValue = v0;
                        singleValue = v1;
                    }
                    return { type: 4, values: [pairValue, singleValue] };
                }
                return { type: 5, values: [v0, v1, v2] }; // å•å¼ ï¼Œå·²é™åº
            }

            getStrength() {
                const handInfo = this.getHandType();
                const type = handInfo.type;
                const values = handInfo.values;

                let baseScore = 0;
                switch (type) {
                    case 0: baseScore = 600000000; break; // è±¹å­
                    case 1: baseScore = 500000000; break; // é¡ºé‡‘
                    case 2: baseScore = 400000000; break; // é‡‘èŠ±
                    case 3: baseScore = 300000000; break; // é¡ºå­
                    case 4: baseScore = 200000000; break; // å¯¹å­
                    case 5: baseScore = 100000000; break; // å•å¼ 
                }

                let score = baseScore;
                for (let i = 0; i < values.length; i++) {
                    let v = values[i];
                    // å¯¹äºè±¹å­ã€é‡‘èŠ±ã€å¯¹å­ã€å•å¼ ï¼ŒAéœ€è¦ä½œä¸º14æ¯”è¾ƒï¼ˆé¡ºå­å’Œé¡ºé‡‘å·²åœ¨straightValsä¸­å¤„ç†ï¼‰
                    if (type === 0 || type === 2 || type === 4 || type === 5) {
                        if (v === 1) v = 14;
                    }
                    // åŠ æƒï¼šç¬¬ä¸€ä½ä¹˜ç™¾ä¸‡ï¼Œç¬¬äºŒä½ä¹˜åƒï¼Œç¬¬ä¸‰ä½ä¹˜ä¸€
                    if (i === 0) score += v * 1000000;
                    else if (i === 1) score += v * 1000;
                    else score += v;
                }
                return score;
            }

            getTypeString() {
                return HAND_TYPE_NAMES[this.getHandType().type];
            }
        }

        // ä»4å¼ ç‰Œä¸­é€‰å‡ºæœ€å¥½çš„3å¼ ç‰Œç»„åˆ
        function createBestHandFromFourCards(fourCards) {
            if (fourCards.length !== 4) {
                return new Hand([]);
            }

            const possibleHands = [];
            // ç”Ÿæˆæ‰€æœ‰4ç§3å¼ ç‰Œç»„åˆ
            for (let i = 0; i < 4; i++) {
                const current3 = [];
                for (let j = 0; j < 4; j++) {
                    if (i !== j) {
                        current3.push(fourCards[j]);
                    }
                }
                possibleHands.push(new Hand(current3));
            }

            // æ‰¾å‡ºç‰ŒåŠ›æœ€å¤§çš„æ‰‹ç‰Œ
            let bestHand = possibleHands[0];
            for (let i = 1; i < possibleHands.length; i++) {
                if (compareHands(possibleHands[i], bestHand) > 0) {
                    bestHand = possibleHands[i];
                }
            }

            return bestHand;
        }

        function compareHands(a, b) {
            const strA = a.getStrength();
            const strB = b.getStrength();
            if (strA !== strB) return strA > strB ? 1 : -1;
            return 0;
        }

        function calculate() {
            // è·å–æ¸¸æˆæ¨¡å¼
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            const fourCardMode = gameMode === 'advanced';

            // è·å–ç”¨æˆ·è¾“å…¥
            const card1Value = parseInt(document.getElementById('card1-value').value);
            const card1Suit = parseInt(document.getElementById('card1-suit').value);
            const card2Value = parseInt(document.getElementById('card2-value').value);
            const card2Suit = parseInt(document.getElementById('card2-suit').value);
            const card3Value = parseInt(document.getElementById('card3-value').value);
            const card3Suit = parseInt(document.getElementById('card3-suit').value);
            const playerCount = parseInt(document.getElementById('player-count').value);
            const simulationCount = parseInt(document.getElementById('simulation-count').value);

            // åˆ›å»ºç”¨æˆ·æ‰‹ç‰Œ
            const userInputCards = [
                new Card(card1Value, card1Suit),
                new Card(card2Value, card2Suit),
                new Card(card3Value, card3Suit)
            ];

            // å¦‚æœæ˜¯è¿›é˜¶æ¨¡å¼ï¼Œæ·»åŠ ç¬¬4å¼ ç‰Œ
            if (fourCardMode) {
                const card4Value = parseInt(document.getElementById('card4-value').value);
                const card4Suit = parseInt(document.getElementById('card4-suit').value);
                userInputCards.push(new Card(card4Value, card4Suit));
            }

            // æ£€æŸ¥é‡å¤ç‰Œ
            const cardSet = new Set();
            for (const card of userInputCards) {
                const key = `${card.value}-${card.suit}`;
                if (cardSet.has(key)) {
                    alert('ä¸èƒ½è¾“å…¥é‡å¤çš„ç‰Œï¼');
                    return;
                }
                cardSet.add(key);
            }

            // é€‰æ‹©æœ€ä¼˜æ‰‹ç‰Œ
            let userHand;
            if (fourCardMode) {
                userHand = createBestHandFromFourCards(userInputCards);
            } else {
                userHand = new Hand(userInputCards);
            }

            const otherPlayersCount = playerCount - 1;
            const cardsToDeal = fourCardMode ? 4 : 3;

            // æ„å»ºå‰©ä½™ç‰Œå †
            const remainingDeck = [];
            for (let s = 0; s < 4; s++) {
                for (let v = 1; v <= 13; v++) {
                    let isUserCard = false;
                    for (const uc of userInputCards) {
                        if (uc.suit === s && uc.value === v) {
                            isUserCard = true;
                            break;
                        }
                    }
                    if (!isUserCard) {
                        remainingDeck.push(new Card(v, s));
                    }
                }
            }

            // è’™ç‰¹å¡ç½—æ¨¡æ‹Ÿ
            let userWins = 0;
            let userTies = 0;

            for (let r = 0; r < simulationCount; r++) {
                // æ´—ç‰Œ
                const shuffledDeck = [...remainingDeck];
                for (let i = shuffledDeck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffledDeck[i], shuffledDeck[j]] = [shuffledDeck[j], shuffledDeck[i]];
                }

                // å‘ç‰Œç»™å¯¹æ‰‹
                const opponents = [];
                for (let i = 0; i < otherPlayersCount; i++) {
                    const pCards = [];
                    for (let j = 0; j < cardsToDeal; j++) {
                        pCards.push(shuffledDeck[i * cardsToDeal + j]);
                    }

                    // å¦‚æœæ˜¯4å¼ ç‰Œæ¨¡å¼ï¼Œç”µè„‘ä¹Ÿè‡ªåŠ¨é€‰æœ€ä¼˜3å¼ 
                    if (fourCardMode) {
                        opponents.push(createBestHandFromFourCards(pCards));
                    } else {
                        opponents.push(new Hand(pCards));
                    }
                }

                // æ‰¾å‡ºæœ€å¤§ç‰Œ
                const allHands = [userHand, ...opponents];
                const winners = [0];

                for (let i = 1; i < allHands.length; i++) {
                    const cmp = compareHands(allHands[i], allHands[winners[0]]);
                    if (cmp > 0) {
                        winners.length = 0;
                        winners.push(i);
                    } else if (cmp === 0) {
                        winners.push(i);
                    }
                }

                const userWonStrictly = winners.length === 1 && winners[0] === 0;
                const userTiedForFirst = winners.includes(0) && winners.length > 1;

                if (userWonStrictly) userWins++;
                else if (userTiedForFirst) userTies++;
            }

            // è®¡ç®—ç»“æœ
            const winRate = (userWins / simulationCount * 100).toFixed(2);
            const tieRate = (userTies / simulationCount * 100).toFixed(2);
            const loseRate = ((simulationCount - userWins - userTies) / simulationCount * 100).toFixed(2);
            const noLoseRate = ((userWins + userTies) / simulationCount * 100).toFixed(2);

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('mode-info').textContent = `æ¸¸æˆæ¨¡å¼: ${fourCardMode ? 'è¿›é˜¶æ¨¡å¼ (4é€‰3)' : 'ç»å…¸æ¨¡å¼ (3å¼ )'}`;
            document.getElementById('win-rate').textContent = winRate + '%';
            
           
            const winRateFloat = parseFloat(winRate);           // ç™¾åˆ†æ¯”æ•°å€¼ï¼Œå¦‚ 20.00
            const threshold = 100 / playerCount;                // 1/äººæ•° å¯¹åº”çš„ç™¾åˆ†æ¯”ï¼Œå¦‚ 16.666...
            const advice = winRateFloat > threshold ? "ä¸æ¨èå¼ƒç‰Œ" : "æ¨èå¼ƒç‰Œ";
            document.getElementById('advice-text').textContent = advice;
            
            
            document.getElementById('result').style.display = 'block';
        }
    </script>
</body>
</html>